package th.ac.bu.science.mit.allappstatscollector.Activities;

import android.content.Intent;
import android.content.pm.ApplicationInfo;
import android.content.pm.PackageInfo;
import android.content.pm.PackageManager;
import android.content.pm.PermissionInfo;
import android.graphics.Color;
import android.graphics.Typeface;
import android.net.Uri;
import android.support.v7.app.AppCompatActivity;
import android.os.Bundle;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.TextView;

import th.ac.bu.science.mit.allappstatscollector.R;

public class MalwareInfoActivity extends GeneralActivity {

    String packageName;
    PackageManager packageManager = null;
    ApplicationInfo appInfo = null;
    PackageInfo packageInfo = null;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_malware_info);

        SetTitle("App Info");

        try {
            Intent intent = getIntent();
            packageName = intent.getExtras().getString("packageName");

            packageManager = getPackageManager();
            packageInfo = packageManager.getPackageInfo(packageName,
                    PackageManager.GET_PERMISSIONS
            );
            appInfo = packageInfo.applicationInfo;

            ShowHeader();
            ShowInfo();
            ShowPermission();
            ShowMockupInfo();
        } catch (final PackageManager.NameNotFoundException e) {
        }
    }

    void ShowHeader() {
        TextView textAppName = (TextView) findViewById(R.id.textAppName);
        TextView textPackageName = (TextView) findViewById(R.id.textPackageName);
        ImageView iconView = (ImageView) findViewById(R.id.appIcon);

        textAppName.setText(appInfo.loadLabel(packageManager));
        textPackageName.setText(packageName);
        iconView.setImageDrawable(appInfo.loadIcon(packageManager));
    }

    void ShowInfo() {
        TextView textVersion = (TextView) findViewById(R.id.textVersionName);
        TextView textVersionCode = (TextView) findViewById(R.id.textVersionCode);

        textVersion.setText(packageInfo.versionName);
        textVersionCode.setText(((Integer) packageInfo.versionCode).toString());
    }

    void ShowPermission() {
        ViewGroup permissionList = (ViewGroup) findViewById(R.id.listPermission);

        try {
            if (packageInfo.requestedPermissions != null) {
                for (String permission : packageInfo.requestedPermissions) {
                    PermissionInfo pmInfo = packageManager.getPermissionInfo(permission, 0);

                    TextView textPermissionLabel = new TextView(this);
                    textPermissionLabel.setTextSize(16);
                    textPermissionLabel.setTypeface(null, Typeface.BOLD);
                    TextView textPermissionDesc = new TextView(this);
                    textPermissionDesc.setTextSize(16);
                    textPermissionDesc.setPadding(0, 0, 0, 30);

                    textPermissionLabel.setText(String.format("%s (%s)", pmInfo.loadLabel(packageManager), permission));
                    textPermissionDesc.setText(pmInfo.loadDescription(packageManager));

                    permissionList.addView(textPermissionLabel);
                    permissionList.addView(textPermissionDesc);
                    textPermissionDesc.requestLayout();
                }
            }
        } catch (final PackageManager.NameNotFoundException e) {
        }
    }

    public void OpenAppManagement(View view) {
        startActivity(new Intent(android.provider.Settings.ACTION_APPLICATION_DETAILS_SETTINGS, Uri.parse("package:" + packageName)));
    }

    void ShowMockupInfo () {
        ViewGroup permissionList = (ViewGroup) findViewById(R.id.listMalwareInfo);

        TextView detectedBy = new TextView(this);
        detectedBy.setTextSize(16);
        detectedBy.setPadding(0, 0, 0, 5);
        detectedBy.setTextColor(Color.RED);
        detectedBy.setText("Detected by 7 Antiviruses.");
        permissionList.addView(detectedBy);

        TextView engien1 = new TextView(this);
        engien1.setTextSize(16);
        engien1.setPadding(0, 0, 0, 5);
        engien1.setTextColor(Color.RED);
        engien1.setText("BitDefender : Android.Adware.Adwo.A");
        permissionList.addView(engien1);

        TextView engien2 = new TextView(this);
        engien2.setTextSize(16);
        engien2.setPadding(0, 0, 0, 5);
        engien2.setTextColor(Color.RED);
        engien2.setText("Symantec : Android.Fokonge");
        permissionList.addView(engien2);

        TextView engien3 = new TextView(this);
        engien3.setTextSize(16);
        engien3.setPadding(0, 0, 0, 5);
        engien3.setTextColor(Color.RED);
        engien3.setText("Avast : Android");
        permissionList.addView(engien3);

        TextView engien4 = new TextView(this);
        engien4.setTextSize(16);
        engien4.setPadding(0, 0, 0, 5);
        engien4.setTextColor(Color.RED);
        engien4.setText("Kaspersky : HEUR");
        permissionList.addView(engien4);

        TextView engien5 = new TextView(this);
        engien5.setTextSize(16);
        engien5.setPadding(0, 0, 0, 5);
        engien5.setTextColor(Color.RED);
        engien5.setText("TrendMicro : ANDROIDOS_KUNGFU.HATA");
        permissionList.addView(engien5);

        TextView engien6 = new TextView(this);
        engien6.setTextSize(16);
        engien6.setPadding(0, 0, 0, 5);
        engien6.setTextColor(Color.RED);
        engien6.setText("Avira : ANDROID/KungFu.cz.1");
        permissionList.addView(engien6);

        TextView engien7 = new TextView(this);
        engien7.setTextSize(16);
        engien7.setPadding(0, 0, 0, 5);
        engien7.setTextColor(Color.RED);
        engien7.setText("McAfee : Artemis!C7EDE8A9100C");
        permissionList.addView(engien7);
    }
}
